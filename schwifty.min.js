export default class Schwifty{constructor({onload:e,selector:t=`a[href^="${window.location.origin}"]:not([data-no-schwifty]), a[href^="/"]:not([data-no-schwifty])`,cacheLimit:o=85,preserveScroll:r=!1,transitioningAttribute:n='data-schwifty',preserveAttributes:a}={}){let l=!0===a;'object'!=typeof a&&(a={documentElement:l,head:l,body:l});let i='schwifty-preload',s='link[rel="stylesheet"]',c=document,d=c.documentElement,u='innerHTML',h=new Map,f=new IntersectionObserver((e,t)=>e.forEach(e=>{let r=e.isIntersecting,n=e.target.href;(r||null==r)&&(h.size>=o&&h.delete(h.keys()[0]),h.get(n)?t.unobserve(e.target):E(n))}),{threshold:.5}),p=(e,t=c)=>t.querySelector(e),m=(e,t=c)=>t.querySelectorAll(e),y=e=>e.target.closest(t)||{},b=()=>m(t).forEach(e=>f.observe(e)),v=(e,t=window)=>t.dispatchEvent(new Event(e)),g=e=>e.replace(/m?s/gi,''),w=()=>{let e=getComputedStyle(d);return 1e3*(g(e.transitionDelay)+g(e.transitionDuration))},E=e=>{if(!e)return;let t=new XMLHttpRequest;t.onreadystatechange=function(){200==this.status&&h.set(e,t.responseXML)},t.open('GET',e,!0),t.responseType='document',t.send()},$=t=>{let o=h.get(t);if(!o)return void(location=t);history.replaceState(null,null,t),m(`${s}:not(.${i})`).forEach(e=>{let t=e.href.replace(location.origin,''),r=p(`${s}.${i}[href="${t}"]`),n=p(`${s}[href="${t}"]`,o);n&&!r&&(e.classList.add(i),d.append(e)),!n&&r&&r.remove()});let l=`${s}.${i}`,f=m(`${s}:not(.${i})`,o),y=m(l);for(let e of y)Array.from(f).some(t=>t.href==e.href)||e.remove();['body','head','documentElement'].forEach(e=>{if(a[e])return;let t=c[e];for(let e of t.attributes)t.removeAttribute(e.name);for(let r of o[e].attributes)t.setAttribute(r.name,r.value)}),d.setAttribute(n,'out'),v('pagehide'),v('unload'),setTimeout(()=>{v('loading',c),c.body[u]=o.body[u],c.head[u]=o.head[u],d.setAttribute(n,'in'),v('interactive',c),v('DOMContentLoaded',c),r||scrollTo(0,0),e&&(e.length?e.map(e=>e()):e()),b(),setTimeout(()=>d.removeAttribute(n),w()),v('complete',c),v('load'),v('pageshow')},w())};b(),addEventListener('popstate',e=>$(location.href)),addEventListener('click',e=>{let t=y(e).href;t&&(e.preventDefault(),v('beforeunload'),history.pushState(null,null,location.href),$(t))})}}